  <!DOCTYPE html>
  <html lang="en">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">

        
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
        
        <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
        <link href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-icons/1.10.0/font/bootstrap-icons.min.css" rel="stylesheet">
        <link rel="stylesheet" href="{{ url_for('static', filename='styles.css') }}">
        
        <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz" crossorigin="anonymous"></script>
     
        <script type="module" src="{{ url_for('static', filename='js/main.js') }}" defer></script>

        <link rel="icon" href="{{ url_for('static', filename='favicon/favicon.ico') }}" type="image/x-icon">
  

        <title>Turnushjelper</title>
        {% block extra_css %}{% endblock %}
    </head>

    <body>


      <header>
        <nav class="navbar navbar-expand-lg modern-navbar">
          <div class="container-fluid">
            <!-- Logo and Brand -->
            <a class="navbar-brand" href="{{ url_for('shifts.index') }}">
              <img src="/static/img/artybadger.png" alt="Turnushjelper" width="40" height="40" class="brand-logo">
              <span class="brand-text">Turnushjelper</span>
            </a>

            <!-- Navigation Icons (visible on small screens) -->
            <div class="d-lg-none mobile-icon-nav">
              <ul class="navbar-nav d-flex flex-row">
                <li class="nav-item">
                  <a class="nav-link mobile-icon-link {% if request.endpoint == 'shifts.turnusliste' %}active{% endif %}" href="{{ url_for('shifts.turnusliste') }}" title="Turnusliste">
                    <i class="bi bi-calendar-week"></i>
                  </a>
                </li>
                <li class="nav-item">
                  <a class="nav-link mobile-icon-link {% if request.endpoint == 'shifts.favorites' %}active{% endif %}" href="{{ url_for('shifts.favorites') }}" title="Favoritter">
                    <i class="bi bi-star"></i>
                  </a>
                </li>
                <li class="nav-item">
                  <a class="nav-link mobile-icon-link {% if request.endpoint == 'shifts.compare' %}active{% endif %}" href="{{ url_for('shifts.compare') }}" title="Grafer">
                    <i class="bi bi-bar-chart"></i>
                  </a>
                </li>
                
              </ul>
            </div>

            <!-- Desktop Navigation Menu (hidden on small screens) -->
            <div class="collapse navbar-collapse d-none d-lg-block" id="navbarNav">
              <ul class="navbar-nav me-auto">
                <li class="nav-item">
                  <a class="nav-link {% if request.endpoint == 'shifts.turnusliste' %}active{% endif %}" href="{{ url_for('shifts.turnusliste') }}">
                    <i class="bi bi-calendar-week"></i>
                    <span>Turnusliste</span>
                  </a>
                </li>
                <li class="nav-item">
                  <a class="nav-link {% if request.endpoint == 'shifts.favorites' %}active{% endif %}" href="{{ url_for('shifts.favorites') }}">
                    <i class="bi bi-star"></i>
                    <span>Favoritter</span>
                  </a>
                </li>
                <li class="nav-item">
                  <a class="nav-link {% if request.endpoint == 'shifts.compare' %}active{% endif %}" href="{{ url_for('shifts.compare') }}">
                    <i class="bi bi-bar-chart"></i>
                    <span>Grafer</span>
                  </a>
                </li>
              
                
              </ul>
            </div>

              
              
              <!-- Right Side Actions -->
              <div class="navbar-actions d-flex align-items-center">
                <!-- Mobile sorter button (visible on small screens) - OUTSIDE action-buttons -->
                {% block mobile_sorter %}{% endblock %}
                
                <!-- Page Title and Navigation -->
                
                <!-- Turnus Set Switcher (only show if multiple sets available) -->
                <div class="action-buttons d-none d-lg-flex align-items-center me-3">
                  {% if current_user.is_authenticated and all_turnus_sets and all_turnus_sets|length > 1 %}
                      {% include 'components/turnus_selector.html' %}
                      <div class="me-2"></div>
                  {% endif %}
                
                <!-- Filtering Controls -->
                  {% block filtering %}{% endblock %}

                <!-- Print Button -->
                  {% block print %}{% endblock %}
                </div>


                <!-- User Menu -->
                <div class="dropdown">
                  <button class="btn btn-outline-light dropdown-toggle user-menu-btn" type="button" data-bs-toggle="dropdown" aria-expanded="false">
                    <i class="bi bi-person"></i>
                    <span class="user-name d-none d-lg-inline">{{ current_user.username | capitalize }}</span>
                  </button>
                  <ul class="dropdown-menu dropdown-menu-end">
                    <li class="dropdown-header">
                      <div class="user-info">
                        <strong>{{ current_user.username | capitalize }}</strong>
                        {% if current_user.is_admin %}
                          <span class="badge bg-primary ms-2">Admin</span>
                        {% endif %}
                      </div>
                    </li>
                    <li><hr class="dropdown-divider"></li>
                 
                    <li>
                      <a class="dropdown-item" href="{{ url_for('downloads.download_pdf') }}">
                        <i class="bi bi-file-earmark-zip"></i> Lagre orginal PDF
                      </a>
                      <a class="dropdown-item" href="{{ url_for('downloads.download_excel') }}">
                        <i class="bi bi-file-earmark-zip"></i> Lagre turns i Excel-fil
                      </a>
                    </li>
                    <li><hr class="dropdown-divider"></li>
                    <li>
                      <a class="dropdown-item" href="{{ url_for('minside.user_minside') }}">
                        <i class="bi bi-person-gear"></i> Min Side
                      </a>
                    </li>
                    <!-- Turnus Set Selector for small screens -->
                    {% if current_user.is_authenticated and all_turnus_sets and all_turnus_sets|length > 1 %}
                    <li class="d-lg-none">
                      <a class="dropdown-item" href="#" onclick="toggleTurnusSubmenu(event)">
                        <i class="bi bi-calendar3"></i> Velg Turnus√•r
                        <i class="bi bi-chevron-right float-end" id="turnus-chevron"></i>
                      </a>
                      <ul class="dropdown-menu turnus-submenu" id="turnus-submenu" style="display: none;">
                        {% for ts in all_turnus_sets %}
                        <li>
                          <a class="dropdown-item {% if current_turnus_set and ts.id == current_turnus_set.id %}active{% endif %}" 
                             href="/switch-year/{{ ts.id }}">
                            <i class="bi bi-{% if current_turnus_set and ts.id == current_turnus_set.id %}check-circle{% else %}circle{% endif %}"></i>
                            {{ ts.year_identifier }}
                          </a>
                        </li>
                        {% endfor %}
                      </ul>
                    </li>
                    <li class="d-lg-none"><hr class="dropdown-divider"></li>
                    {% endif %}
                    
                    <!-- Print button for small screens -->
                    {% block mobile_print %}
                    <li class="d-lg-none">
                      <a class="dropdown-item mobile-print-item" href="#" onclick="printTables(); return false;">
                        <i class="bi bi-printer"></i> Utskrift
                      </a>
                    </li>
                    {% endblock %}
                    {% if current_user.is_admin %}
                    <li>
                      <a class="dropdown-item" href="{{ url_for('admin.admin_dashboard') }}">
                        <i class="bi bi-gear"></i> Admin Panel
                      </a>
                    </li>
                    {% endif %}
                    <li><hr class="dropdown-divider"></li>
                    <li>
                      <a class="dropdown-item text-danger" href="{{ url_for('auth.logout') }}">
                        <i class="bi bi-box-arrow-right"></i> Logg ut
                      </a>
                    </li>
                  </ul>
                </div>
              </div>
            </div>
          </div>
        </nav>
      </header>


      
    

      <main>
        {% block content %}{% endblock %}
      </main>

      <script>
        function toggleTurnusSubmenu(event) {
          event.preventDefault();
          event.stopPropagation();

          const submenu = document.getElementById('turnus-submenu');
          const chevron = document.getElementById('turnus-chevron');

          if (submenu.style.display === 'none' || submenu.style.display === '') {
            submenu.style.display = 'block';
            chevron.classList.remove('bi-chevron-right');
            chevron.classList.add('bi-chevron-down');
          } else {
            submenu.style.display = 'none';
            chevron.classList.remove('bi-chevron-down');
            chevron.classList.add('bi-chevron-right');
          }
        }
      </script>

      <!-- Shift Timeline Modal -->
      <div class="modal fade" id="shiftTimelineModal" tabindex="-1" aria-labelledby="shiftTimelineModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-xl modal-dialog-centered">
          <div class="modal-content">
            <div class="modal-header">
              <h5 class="modal-title" id="shiftTimelineModalLabel">
                <i class="bi bi-clock-history me-2"></i>
                <span id="shiftTimelineTitle">Tidslinje</span>
              </h5>
              <!-- Zoom controls -->
              <div class="shift-timeline-zoom-controls me-3">
                <button type="button" class="btn btn-sm btn-outline-light" id="shiftTimelineZoomOut" title="Zoom ut">
                  <i class="bi bi-zoom-out"></i>
                </button>
                <span class="zoom-level" id="shiftTimelineZoomLevel">100%</span>
                <button type="button" class="btn btn-sm btn-outline-light" id="shiftTimelineZoomIn" title="Zoom inn">
                  <i class="bi bi-zoom-in"></i>
                </button>
                <button type="button" class="btn btn-sm btn-outline-light ms-2" id="shiftTimelineZoomReset" title="Tilbakestill zoom">
                  <i class="bi bi-arrow-counterclockwise"></i>
                </button>
              </div>
              <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Lukk"></button>
            </div>
            <div class="modal-body text-center p-0">
              <!-- Loading spinner -->
              <div id="shiftTimelineSpinner" class="py-5">
                <div class="spinner-border text-primary" role="status">
                  <span class="visually-hidden">Laster...</span>
                </div>
                <p class="mt-3 text-muted">Henter tidslinje...</p>
              </div>
              <!-- Timeline image container with zoom/pan -->
              <div id="shiftTimelineWrapper" class="shift-timeline-wrapper">
                <div id="shiftTimelineContainer" class="shift-timeline-container">
                  <img id="shiftTimelineImage" class="shift-timeline-image" alt="Tidslinje" style="display: none;">
                </div>
                <div id="shiftTimelineResizeBar" class="shift-timeline-resize-bar"></div>
              </div>
              <!-- Error message -->
              <div id="shiftTimelineError" class="alert alert-warning m-3" style="display: none;">
                <i class="bi bi-exclamation-triangle me-2"></i>
                <span>Kunne ikke laste tidslinje</span>
              </div>
            </div>
          </div>
        </div>
      </div>

    </body>
  </html>
    